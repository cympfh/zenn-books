---
title: コマンド紹介 ー 数値計算

---

いよいよ数値計算に入る. といっても. スタックマシンの手続きにさえ気をつけてくれれば, 中でやってる事自体は何も難しくない.

## 四則演算

加減乗除のこと.  それぞれ `+` `-` `*` `/` で計算する.  実行ステップは次の通り.

1. スタックから二回 pop してデータを2つ持ってくる
2. その2つを加減乗除した値を push する


$+$ と $\times$ は順序を気にしなくていい分, 簡単だ.

```bash
> 1 2 +
> p
3

> 2 3 *
> p
6
```

$-$ と $\div$ には順序がある（もちろん $x - y$ と $y-x$ は一般には結果が異なる）ので注意が必要だ.

1. pop して得たデータを順に $y$, $x$ とするとき
2. $x-y$ または $x \div y$ の結果を push する

pop する順で書くと $x$ と $y$ が直観と逆に思えるかもしれないが, 一行のコマンドで書くとこれは自然だ.

```bash
> 2 1 -
> p
1

> 8 2 /
> p
4
```

例えば `2 1 -` は「2 から 1 を引く」と読もう. 同様に `8 2 /` は「8を2で割る」と読む.
このように計算対象となる数値をすぐそこに書いてる場合には簡単だが, 計算式が入り組むとやや慣れを要する.

```bash
2 4 + 3/
```

慣れればこれは「2 と 4 を足して, それを 3 で割る」と読める.
スタックマシンの特徴に, 計算式に括弧がない（必要ないとも言えるし, 使えないとも言える）ことが挙げられる.  数式なら, $+$ や $-$ よりも $\times$ や $\div$ の優先順位があって, さらに括弧がある場合はそこを先に計算して... といった計算順序のルールがある. スタックマシンの場合は単純で, ただただ左から一直線に実行するだけである. 慣れれば十分読みやすい.

## 平方根

一文字コマンド `v` はスタックのトップの数値を, その平方根で置き換える.

## その他

`^` は冪乗を計算するし, `%` は剰余を計算する. その他色んな演算があるが, この文章は dc の紹介が目的であって完全なマニュアルが目的ではないのでここでは詳細してしまうことにする. 自分で書いた完全なコマンドリファレンスがあるので, 最後にリンクする形で紹介する.

## 計算精度について

### 浮動小数の精度

そんなことより大事な話がある. 精度の話だ.

割り算はデフォルトでは整数の範囲でしか計算しない. 例えば $7 \div 2$ を計算するために `7 2/` と入力しても, 答えは $3.5$ ではなく `3` として計算される. これは整数の範囲に丸め込まれた結果だ. 平方根も同様だ. $\sqrt{10}$ を計算するべく `10v` と入力しても `3` が得られる.

```bash
> 7 2/
> p
3

> 10vp
3
```

この挙動の正確な説明はこうだ.  答えが小数になる計算をすると $0$ の方向に最も近い整数に丸め込まれている (Round half towards zero). コンピュータはそもそも有限のものしか扱えないから, 小数を完全に正確に計算するというのは難しい. 大抵のプログラムがこの問題にどう対応しているのかと言えば, ある程度の誤差は諦めるとか, あるいはコストは高くなるけれど全く別なアプローチを使う（有理数の範囲で計算するとか）. 一方で dc では精度をユーザーが自由に設定出来るようにした. すなわち, 小数点以下何桁を正確に計算されることを保証された下で計算をすることが出来る. そしてこの桁数のデフォルトは $0$ だ. すなわち小数点以下を捨てた整数の範囲で正確に計算がなされる.

精度（小数点以下の桁数）を指定するに `k` コマンドを使う. `k` はスタックから値を一つ取り出す. 取り出される値は $0$ 以上の整数である必要がある. これが $n$ のとき, 以降の計算について小数点以下 $n$ 桁について正確であることを保証してくれる.

:::message
`k` も `R` と同様に, その前に数値パラメータを受け取るコマンドだと思うことが出来る. `3k` とか `5k` みたいに.
:::

```bash
> 22 7/ p
3  # デフォルトでは整数

> 3k
# 以降 3 桁保証
> 22 7/p
3.142

> 5k
# 以降 5 桁保証

> p
3.142
# あとから桁数を変えても以前の計算結果は変わらない

> 2vp
1.41421
```

### 多倍長整数

精度というと小数の方だけじゃなくて, 整数の方の話もある. 一部の（というか、ほとんどの）プログラミング言語では扱える整数の大きさの方にも制限を設けていることが多い. 例えば $19$ 桁程度の整数（$=2^{64}$ 程度）は大きすぎるので計算に失敗する, といった挙動をさせる言語がある. dc ではこれはない. どんなに大きな, 或いは小さな数でも整数部分については正確であることを保証してくれる.

下は十分大きな数として $2^{100}$ を計算する例:

```bash
> 2 200 ^
> p
1606938044258990275541962092341162602522202993782792835301376
```

